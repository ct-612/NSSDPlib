# **NSSDPlib 项目启动需求文档**

## 一、背景与目标

### 1.1 项目背景

差分隐私（Differential Privacy, DP）已成为隐私保护的事实标准。当前业界存在多个分散实现（如 OpenDP、Google DP、IBM DPL），但缺乏一个同时支持 **中心化差分隐私（CDP）** 与 **本地差分隐私（LDP）** 的统一框架，能在同一代码库中提供算法机制、数据抽象、模型训练与分析工具的全流程支持。

NSSDPlib（NSS Differential Privacy Library）旨在构建一个 **模块化、可扩展、可验证** 的统一差分隐私库，支持从基础机制到机器学习、从隐私预算会计到效用分析的完整闭环。

### 1.2 项目目标

* **统一架构**：提供统一的核心框架（core）、CDP 模块、LDP 模块三层结构。
* **可复用组件**：实现机制工厂、隐私会计、敏感度分析、组合定理、聚合器等通用组件。
* **可验证隐私**：提供形式化隐私证明与测试工具。
* **可扩展生态**：开放接口支持第三方机制与模型插件。
* **高效运行**：兼顾数值稳定性与计算性能，支持大规模实验与基准测试。

---

## 二、MVP 功能清单

| 模块       | 功能项                             | 说明              |
| -------- | ------------------------------- | --------------- |
| **core** | 机制抽象基类（BaseMechanism）         | 定义统一接口与隐私预算属性   |
|          | 隐私会计器（PrivacyAccountant）      | 实现 ε-δ 预算累积与验证  |
|          | 组合定理框架（Composition）           | 支持基本组合与并行组合     |
|          | 数据域与敏感度（Domain、Sensitivity） | 计算全局与局部敏感度      |
| **cdp**  | 高斯与拉普拉斯机制                       | 核心噪声注入实现        |
|          | 高级组合（Moments Accountant）        | 支持 DP-SGD 等高级会计 |
|          | DP-SGD 与线性模型训练                  | 基础 ML 支持        |
|          | 隐私查询分析（mean, sum, histogram）    | 常见统计查询接口        |
| **ldp**  | GRR、OUE、OLH 机制                  | 离散型 LDP 机制实现    |
|          | 连续值机制（Laplace, Duchi）           | 连续数据保护支持        |
|          | 编码器与聚合器                         | 用户侧编码与聚合框架      |
|          | Heavy Hitters 与频率估计             | 典型 LDP 应用场景     |
| **测试体系** | 单元测试（pytest）                    | 全模块覆盖           |
|          | 集成测试                            | 验证跨模块隐私一致性      |
|          | 属性测试                            | 验证 ε-δ 满足与准确性边界 |
|          | 性能与基准测试                         | 机制性能对比、扩展性验证    |

MVP 范围：

* 完成核心抽象层（core）+ CDP 与 LDP 的基础机制与测试。
* 实现至少两类端到端使用示例（CDP 与 LDP 各一）。
* 输出可用 Python 包（可通过 pip install 本地安装）。

---

## 三、非功能需求

### 3.1 性能要求

| 指标        | 目标值                   |
| --------- | --------------------- |
| 机制调用开销    | 单次噪声生成 ≤ 1 ms（标量）     |
| 向量机制      | 10⁶ 维度数据噪声处理 ≤ 500 ms |
| DP-SGD 训练 | 支持 10⁵ 样本级训练（GPU加速）   |
| 聚合器       | 1000 用户 LDP 聚合 ≤ 2 秒  |

### 3.2 兼容性

| 维度        | 要求                                        |
| --------- | ----------------------------------------- |
| Python 版本 | 3.9, 3.10, 3.11,3.12,3.13（测试矩阵）                     |
| 操作系统      | Linux / macOS / Windows                   |
| 依赖兼容      | numpy, scipy, torch, scikit-learn, sphinx |
| 构建系统      | setuptools + pyproject.toml               |
| 文档系统      | Sphinx + ReadTheDocs 风格                   |

### 3.3 依赖版本

| 库                | 最低版本    | 说明                   |
| ---------------- | ------- | -------------------- |
| numpy            | ≥ 1.24  | 数值计算核心               |
| scipy            | ≥ 1.10  | 概率分布与统计函数            |
| pandas           | ≥ 2.0   | 数据处理与结构化接口           |
| tqdm             | ≥ 4.65  | 进度条与批处理日志            |
| scikit-learn     | ≥ 1.2   | 模型评估与基准算法            |
| tensorflow       | ≥ 2.12  | 深度学习训练接口             |
| torch            | ≥ 2.1   | 通用机器学习与 DP-SGD 支持    |
| matplotlib       | ≥ 3.7   | 可视化与报告输出             |
| bitarray         | ≥ 2.5   | 位级数据表示（如 LDP 编码）     |
| xxhash           | ≥ 3.2   | 高速哈希（机制与聚合器）         |
| datasketch       | ≥ 1.5.2 | LDP/聚合近似算法支持         |
| mmh3             | ≥ 3.0.0 | MurmurHash 实现，用于哈希机制 |
| sphinx           | ≥ 5.0   | 文档生成                 |
| sphinx-rtd-theme | ≥ 1.2   | 文档主题                 |
| jupyter          | ≥ 1.0   | 教程与实验交互环境            |
| pytest           | ≥ 7.0   | 测试框架                 |
| pytest-cov       | ≥ 4.0   | 测试覆盖率报告              |
| black            | ≥ 23.3  | 代码格式化                |
| isort            | ≥ 6.0   | 导入排序                 |
| pre-commit       | ≥ 3.3   | 提交前代码检查              |
| flake8           | ≥ 6.0   | 代码风格检查                |
| mypy             | ≥ 1.5   | 类型检查                 |
| build            | ≥ 1.0   | 打包工具                 |
---

## 四、关键约束

| 约束项         | 内容                                                              |
| ----------- | --------------------------------------------------------------- |
| **客户端体积限制** | 最终 wheel 包 ≤ 30 MB                                              |
| **隐私保证范围**  | 满足 (ε, δ)-DP 且 ε ≤ 2.0, δ ≤ 1e−5 的配置通过验证                        |
| **随机数安全性**  | 统一使用 numpy.random.Generator，不允许非加密安全 PRNG |
| **测试环境一致性** | 所有测试在 Python 3.11 下通过                                           |
| **敏感度假设**   | 默认全局敏感度模型，局部敏感度需显式声明                                            |

---

## 五、初步验收标准

### 5.1 单元测试

| 指标                 | 标准           |
| ------------------ | ------------ |
| 覆盖率                | ≥ 90%（语句级）   |
| 关键模块（core/cdp/ldp） | 覆盖率 ≥ 95%    |
| 异常路径测试             | 所有机制异常分支必须测试 |

### 5.2 性能指标

| 项目          | 指标                    |
| ----------- | --------------------- |
| 基准测试通过率     | ≥ 95% 达到性能目标          |
| DP-SGD 训练速度 | 不低于 OpenDP 同类实现的 0.9× |
| 机制调用延迟      | < 1 ms/调用（标量）         |

### 5.3 隐私测试

| 测试项     | 验收标准                      |
| ------- | ------------------------- |
| ε-δ 验证  | 所有机制满足理论上限（≤目标 ε, δ）      |
| 组合验证    | 基本与高级组合结果与理论一致（误差 ≤ 1e−3） |
| 重复实验一致性 | 同机制在相同随机种子下输出一致           |
| 隐私报告    | 自动生成隐私预算报告与效用分析图表         |

---

## 六、交付物

| 类别  | 交付物                            |
| --- | ------------------------------ |
| 代码  | 完整可构建的 Python 包 (`src/dplib/`) |
| 文档  | `/docs` 下 Sphinx 可编译文档         |
| 测试  | `/tests` 全套 pytest 套件与报告       |
| 示例  | `/examples` 基础与高级用例            |
| 笔记本 | `/notebooks/tutorials` 教学示例    |
| 基准  | `/benchmarks` 性能与准确性对比脚本       |

---

## 七、附录

* **项目代号**：NSSDPlib
* **版本阶段**：MVP v0.1
* **项目负责人**：——
* **目标发布日期**：
* **版本控制**：GitHub + pytest CI
* **许可证**：

---
